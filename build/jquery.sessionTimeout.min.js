/*! jquery.sessiontimeout 2013-08-08 */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){var b,c,d,e,f,g,h,i,j,k={},l=new Date,m="sessionTimeout_"+l.getTime(),n="0.0.2",o=!1,p={autoping:!1,enableidletimer:!0,timeout:3e5,resource:"spacer.gif",promptfor:0,onprompt:a.noop,ontimeout:a.noop,pollactivity:1e3};a.fn.sessionTimeout=function(q,r){return k={_init:function(){o=a.isFunction(a.idleTimer),o&&(c=a(document)),r.promptfor>r.timeout&&(a.error("jquery.sessionTimeout: configuration error, promptfor must be less than timeout"),r.promptfor=r.timeout),o&&r.enableidletimer&&r.pollactivity>r.promptfor&&(a.error("jquery.sessionTimeout: configuration error, pollactivity must be less than promptfor if set"),r.pollactivity=r.promptfor),a.isFunction(r.onprompt)||a.error("jquery.sessionTimeout: the onprompt parameter is expecting a function"),a.isFunction(r.ontimeout)||a.error("jquery.sessionTimeout: the ontimeout parameter is expecting a function"),k._startCountdown.apply(),e=new Date,a(document).trigger("create.sessionTimeout",[n,l,e-l])},version:function(){return n},_startCountdown:function(){g=new Date,h=g.getTime(),i=h+r.timeout,r.autoping===!0?j=window.setTimeout(function(){k.ping.apply()},r.timeout):o&&r.enableidletimer?(a.idleTimer(Number(r.pollactivity)),window.clearTimeout(j),window.clearTimeout(d),j=window.setTimeout(function(){k._beforeTimeout.apply()},r.timeout-r.promptfor),c.one("active.idleTimer",function(){k._stopCountdown.apply(),k.ping.apply(),d=window.setTimeout(function(){k.ping.apply()},r.timeout)}),c.one("idle.idleTimer",function(){window.clearTimeout(d)}),a(document).bind("expired.sessionTimeout",function(){c.unbind("active.idleTimer"),c.unbind("idle.idleTimer")}),"undefined"==typeof a.data(document,"idleTimer")&&c.trigger("idle.idleTimer")):(window.clearTimeout(j),j=window.setTimeout(function(){k._beforeTimeout.apply()},r.timeout-r.promptfor)),a(document).trigger("startCountdown.sessionTimeout")},_stopCountdown:function(){window.clearTimeout(f),window.clearTimeout(j),window.clearTimeout(d)},_beforeTimeout:function(){f=setTimeout(function(){a.isFunction(r.ontimeout)&&r.ontimeout.call(this),a(document).trigger("expired.sessionTimeout")},r.promptfor),a.isFunction(r.onprompt)&&(r.onprompt.call(this),a(document).trigger("prompt.sessionTimeout"))},_fetch:function(){var c=new Date,d=c.getTime(),e=/^(.+)\.([^\.]*)?$/,f=/^jpg|jpeg|png|gif|bmp$/,g=r.resource.match(e),h=g[2],i=f.test(h);"undefined"==typeof b?i?a("body").append("<img id='"+m+"' src='"+r.resource+"&timestamp="+d+"' style='position: absolute; height: 1px; width: 1px' alt='web page session management helper'>"):a("body").append("<iframe id='"+m+"' src='"+r.resource+"&tstamp="+d+"' style='display: none !important' alt='web page session management helper'></iframe>"):b.attr("src",r.resource+"&timestamp="+d),b=a("#"+m)},ping:function(){k._stopCountdown.apply(),k._fetch.apply(),k._startCountdown.apply(),a(document).trigger("ping.sessionTimeout")},duration:function(){return Number(r.timeout)},elapsed:function(){var a=new Date-e||void 0;return a},remaining:function(){var a=new Date,b=a.getTime(),c=h,d=Number(r.timeout),f=d+(c-b)>0?d+(c-b):0;return"undefined"==typeof e?void 0:f},destroy:function(){a(document).trigger("destroy.sessionTimeout"),void 0!==b&&(b.remove(),b=void 0),k._stopCountdown.apply(),o&&c.unbind(".idleTimer"),e=void 0,a(document).off(".sessionTimeout"),o&&c.idleTimer("destroy")},getStartTime:function(){return h},getEndTime:function(){return i},getKeepAliveTimer:function(){return j},getResourceLoaded:function(){return b}},k[r]||(r=a.extend(r,q)),r=a.extend(p,r),k[q]?k[q].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof q&&q?(a.error("Method "+q+" does not exist on jQuery.sessionTimeout"),void 0):k._init.apply(this,arguments)}});